#!/bin/bash
# openbsd-nc is important! 
SCRIPT_DIR=$(dirname $(readlink -f $0))
source $SCRIPT_DIR/../kvm/lib-helper.sh
source $SCRIPT_DIR/config-common
source $SCRIPT_DIR/config-machine

if [ "x$MACHINE" == "x" ]; then
	echo "Usage:"
	echo "$0 [machine-name]"
	exit 3
fi

if [ ! -d "$MACHINE_PATH" ]; then
	echo "Machine $MACHINE does not exists"
	echo "Reason: $MACHINE_PATH does not exist"
	exit 1
fi

STATE=$MACHINE_PATH/var/evdev_state
ID="$( cat $STATE )"
EVDEV="$2"
source $MACHINE_PATH/config

#if ! contains $ID $STATE; then
	mon-send "$MACHINE" "object_add id=evdev_$ID,qom-type=$EVDEV"  
	echo	"$(( ID +1 ))" > $STATE 
	exit 0
#else 
#	echo "$ID $STATE allready connected"
#fi

exit 1
